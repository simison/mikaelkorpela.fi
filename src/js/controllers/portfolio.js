/**
 * Controller for portfolio
 */
mikael.controller('portfolioCtrl', function($scope, $document) {

    // Open modal
    $scope.openCard = function(card) {
        if(!card.open_url_directly) $scope.card = card;
        else window.location = card.url;
    };

    // Squeeze the duck!
    $scope.duckie = function(play) {
        if (!$scope.kvaak) {
            $scope.kvaak = new Audio('/assets/audio/kvaak.mp3');
        }

        // ngMouseover will just load this (and not play), hence the boolean
        if(play) $scope.kvaak.play();
    }


    // Portfolio contents
    $scope.works = [
        {
            'title': 'Visit Finland & Finnish tourist board',
            'tags': ['Code'],
            'employer': 'Byroo',
            'year': '2013',
            'caption': 'Wordpress, Facebook.',
            'story': 'Rather big and advanced CMS style implementation with Wordpress for Finnish tourist board (mek.fi) and a few campaings & maintenance for VisitFinland.com.',
            'cover': "mek_thumb.jpg",
            'cover_2x': "mek_thumb@2x.jpg",
            //'cover': "visitfinland_thumb.png",
            //'cover_2x': "visitfinland_thumb@2x.png",
            'images': [
                'mek_front1.jpg',
                'mek_front2.jpg',
                'visitfinland_blogsposure1.jpg',
                'visitfinland_blogsposure2.jpg',
                'visitfinland_blogsposure3.jpg',
                'visitfinland_finnair_a.jpg',
                'visitfinland_finnair_b.jpg'
            ],
            'urls': [
                {
                    'url': 'http://www.mek.fi',
                    'url_label': 'mek.fi'
                },
                {
                    'url': 'http://www.visitfinland.com/finnair',
                    'url_label': 'visitfinland.com/finnair/'
                },
                {
                    'url': 'https://www.facebook.com/visitfinland/app_400443586708442',
                    'url_label': 'Blogsposure'
                }
            ]
        },
        {
            'title': 'Thisissand',
            'tags': ['Code'],
            'caption': 'Single page app.',
            'story': 'Single page app using AngularJS for web and for mobile app.',
            'cover': "thisissand_thumb.jpg",
            'cover_2x': "thisissand_thumb@2x.jpg",
            'year': '2014',
            'images': ['thisissand1.jpg','thisissand2.jpg']
        },
        {
            'title': 'TrustRoots',
            'tags': ['Design', 'Code','Community'],
            'caption': 'MeteorJS',
            'year': '2014-',
            'story': 'A prototype of a platform for sharing and getting people together.',
            'url': 'http://bikeshed.meteor.com/',
            'url_label': 'Trustroots.org',
            'cover': "trustroots_thumb.jpg",
            'cover_2x': "trustroots_thumb@2x.jpg",
            'images': ['trustroots_front.jpg','trustroots_profile.jpg']
        },
        {
            'title': 'Karhu',
            'tags': ['Code'],
            'employer': 'Byroo',
            'caption': 'Wordpress',
            'story': 'Wordpress implementation for the finnish beer Karhu in 2012 and 2013. Sinebrychoff is the biggest brewery in Finland.',
            'cover': "karhu_thumb.jpg",
            'year': '2012—2013',
            'url': 'http://www.karhu.fi/',
            'url_label': 'Karhu.fi',
            'cover_2x': "karhu_thumb@2x.jpg",
            'images': ['karhu_2013.png','karhu_2012.jpg','karhu_tuplahumala_2013.jpg']
        },
        {
            'title': 'Reissumies',
            'tags': ['Code'],
            'employer': 'Byroo',
            'caption': 'Facebook',
            'story': 'A Facebook campaing for Reissumies bread',
            'year': '2014',
            'url': 'https://apps.facebook.com/reissumies_kuvakisa/',
            'url_label': 'Kampanja Facebookissa',
            'cover': "reissumies_thumb.jpg",
            'cover_2x': "reissumies_thumb@2x.jpg",
            'images': ['reissumies.jpg']
        },
        {
            'title': 'Mainio Clothing',
            'tags': ['Code'],
            'employer': 'Byroo',
            'caption': 'Wordpress',
            'story': 'Fully responsive Wordpress site for a new clothing brand for children.',
            'year': '2014',
            'url': 'http://blog.mainioclothing.com/',
            'url_label': 'blog.mainioclothing.com',
            'cover': "mainio_thumb.jpg",
            'cover_2x': "mainio_thumb@2x.jpg",
            'images': ['mainio_front.jpg','mainio_content.jpg']
        },
        {
            'title': '358',
            'tags': ['Code'],
            'employer': 'Byroo',
            'caption': 'Parallax',
            'story': 'Early years of parallax boom and a website for an advertising agency.',
            'year': '2012',
            'url': 'http://www.358.fi/',
            'url_label': '358.fi',
            'cover': "358_thumb.jpg",
            'cover_2x': "358_thumb@2x.jpg",
            'images': ['358_parallax0.jpg','358_parallax1.jpg','358_parallax2.jpg']
        },
        {
            'title': 'Hitchwiki',
            'tags': ['Design', 'Code','Community'],
            'story': 'Hitchwiki is an open source project and a community gathering over 100 000 visitors a month. It is the ',
            'cover': "hitchwiki_thumb.jpg",
            'cover_2x': "hitchwiki_thumb@2x.jpg",
            'images': ['hitchwiki_phrasebook.png','hitchwiki_maps_v1.jpg','hitchwiki_front_2012.jpg', 'hitchwiki_wiki_2013.jpg'],
            'year': '2008—',
            'urls': [
                {
                    'url': 'http://hitchwiki.org',
                    'url_label': 'hitchwiki.org'
                },
                {
                    'url': 'http://hitchwiki.org/maps',
                    'url_label': 'Maps'
                },
                {
                    'url': 'http://hitchwiki.org/phrasebook-v2',
                    'url_label': 'Phrasebook'
                },
                {
                    'url': 'http://hitchgathering.org',
                    'url_label': 'Hitchgathering'
                }
            ]
        },
        {
            'title': 'Suomi.fi campaings',
            'tags': ['Code'],
            'employer': 'Byroo',
            'year': '2013',
            'story': 'A few campaings involving a tad bit more complex UI elements and designs for Suomi.fi portal.',
            'cover': "suomifi_thumb.png",
            'cover_2x': "suomifi_thumb@2x.png",
            'images': ['suomifi_asiointitili_1.jpg','suomifi_asiointitili_2.jpg','suomifi_kuntapuntari_b.jpg'],
            'url': 'http://kuntatalkoot.suomi.fi/',
            'url_label': 'kuntatalkoot.suomi.fi'
        },
        {
            'title': '<i class="icon icon-github"></i>',
            'tags': ['Design','Code'],
            'cover': "portfolio2_thumb.jpg",
            'cover_2x': "portfolio2_thumb@2x.jpg",
            'caption': 'Check from GitHub how this portfolio was made!',
            'url': 'https://github.com/simison/mikaelkorpela.fi',
            'open_url_directly': true
        },
        {
            'title': 'Own works',
            'tags': ['Design', 'Code'],
            'story': '',
            'cover': "ihminen_thumb.jpg",
            'cover_2x': "ihminen_thumb@2x.jpg",
            'images': [
                'wanderlust_2013.jpg',
                'ihminen_2011.jpg',
                'portfolio_2011.jpg',
                'portfolio_2010.jpg',
                'kayntikortti_2011.jpg',
                //'kayntikortti_2010.jpg'
            ],
            'urls': [
                {
                    'url': 'http://www.ihminen.org',
                    'url_label': 'Ihminen.org'
                },
                {
                    'url': 'http://www.wanderlust.lt',
                    'url_label': 'Wanderlust.lt'
                }
            ]
        },
        {
            'title': 'Icons and symbols',
            'tags': ['Design'],
            'employer': 'Into-Digital, Gemilo',
            'year': '2008—2010',
            'story': 'For various projects.',
            'cover': "icons_thumb.jpg",
            'cover_2x': "icons_thumb@2x.jpg",
            'images': ['icons_1.jpg', 'icons_2.jpg']
        },
        {
            'title': 'SunSauna',
            'tags': ['Design'],
            'employer': 'Into-Digital',
            'caption': 'Winner of Grand One 2010 in "best Infodesign".',
            'story': 'Winner of <a href="http://grandone.fi/">Grand One 2010</a> in "best Infodesign". My role as an AD was to wrap rather large amount of contents into easy to access, beautiful and clear package.<br><a href="http://vierityspalkki.fi/2011/08/12/webbisivustotuotanto-voi-olla-kannattavaa-case-into-digital/">Read more from Vierityspalkki.fi</a>',
            'cover': "sunsauna_thumb.jpg",
            'url': 'http://www.sunsauna.fi',
            'url_label': 'sunsauna.fi',
            'year': '2009',
            'cover_2x': "sunsauna_thumb@2x.jpg",
            'images': ['sunsauna_etusivu.png','sunsauna_sisasivu.png']
        },
        {
            'title': 'Vivago',
            'tags': ['Code'],
            'employer': 'Crasman',
            'year': '2011',
            'story': 'Frontend code on top of Crasman Stage CMS.',
            'cover': "vivago_thumb.png",
            'cover_2x': "vivago_thumb@2x.png",
            'url': 'http://www.vivago.fi',
            'url_label': 'vivago.fi',
            'images': ['vivago_front.jpg','vivago_pro_front.jpg']
        },
        {
            'title': 'Porkkanamafia',
            'tags': ['Design','Community'],
            'story': 'I was one of the folks bringing Carrotmob activism to Finland. We organized dozen events and I made the site for Finnish Carrotmobbers.',
            'cover': "porkkanamafia_thumb.jpg",
            'cover_2x': "porkkanamafia_thumb@2x.jpg",
            'year': '2008—2010',
            'images': [
                'porkkanamafia_www.png',
                'porkkanamafia_klubi_juliste.jpg',
                'porkkanamafia_nordic_juliste.jpg',
                'porkkanamafia_kauppa_hki.jpg',
                'porkkanamafia_kahvilla.jpg',
                'porkkanamafia_jkl.jpg'
            ],
            'urls': [
                {
                    'url': 'http://www.porkkanamafia.fi/',
                    'url_label': 'Porkkanamafia.fi'
                },
                {
                    'url': 'https://www.facebook.com/porkkanamafia',
                    'url_label': 'Facebook'
                }
            ]
        },
        {
            'title': 'Nico Rosberg',
            'tags': ['Code'],
            'employer': 'Into-Digital',
            'caption': 'Wordpress',
            'story': 'F1-quality Wordpress implementation for a world class formula driver.',
            'cover': "nicorosberg_thumb.jpg",
            'cover_2x': "nicorosberg_thumb@2x.jpg",
            'url': 'http://www.nicorosberg.com',
            'year': '2010',
            'url_label': 'www.nicorosberg.com',
            'images': ['nicorosberg.jpg']
        },
        {
            'title': 'Tarjousagentti',
            'tags': ['Design'],
            'employer': 'Into Digital',
            'year': '2009',
            'story': 'Very UX/UI heavy project for a site selling used cars.',
            'cover': "tarjousagentti_thumb.jpg",
            'cover_2x': "tarjousagentti_thumb@2x.jpg",
            'images': ['tarjousagentti_etusivu.png','tarjousagentti_sisasivu.png']
        },
        {
            'title': 'Rautayrtti',
            'tags': ['Design'],
            'story': 'Unpublished album design.',
            'year': '2010',
            'cover': "ry_thumb.jpg",
            'cover_2x': "ry_thumb.jpg",
            'images': ['ry_kansi.jpg','ry_takaisivu.jpg','ry_inlay_and_cd.jpg']
        },
        {
            'title': 'Älypää / Sanoma Games',
            'tags': ['Design'],
            'employer': 'SanomaWSOY',
            'year': '2006-2008',
            'story': 'Graphic design for flash/mobile -games for alypaa.com and for their customers. Älypää is the biggest quiz online community in Finland with over 130 000 different visitors per week. Customers included many of the biggest companies and brands in Finland, such as Alko, Viking Line, Nindendo, SAK, S-ryhmä, Itella and many more.',
            'cover': "alypaa_thumb.jpg",
            'cover_2x': "alypaa_thumb@2x.jpg",
            'url': 'http://alypaa.com',
            'url_label': 'alypaa.com',
            'images': ['alypaa_www2.png','alypaa_alko.png','alypaa_sak.png']
        },
    ];

    // Open modal
    $scope.card = false;

    $scope.cardURL = function(card) {
        return (card.open_url_directly) ? card.url : '#';
    };

    // Close modal
    //$document.bind("keydown keypress", function (event) {
    $scope.closeCard = function() {
        $scope.card = false;
        console.log('close!');
    };
    /*
    $document.bind('keydown', function(e) {
        if(e.which === 27) { // Esc
            delete $scope.card;
            console.log('esc');
        }
    });
    */


})
.directive('imageloaded', [
    function () {
        'use strict';
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                var cssClass = attrs.loadedclass;
                element.bind('load', function (e) {
                    angular.element(element).addClass(cssClass);
                });
            }
        }
    }
]);



/**
 * modal modal
 * @link http://codepen.io/hakimel/pen/wFfGs
 */
(function(){

  var container = document.documentElement,
		popup = document.querySelector( '.modal-popup' ),
		cover = document.querySelector( '.modal-cover' ),
		currentState = null;

	// Deactivate on ESC
	function onDocumentKeyUp( event ) {
		if( event.keyCode === 27 ) {
			deactivate();
		}
	}

	// Deactivate on click outside
	function onDocumentClick( event ) {
		if( event.target === cover ) {
			deactivate();
		}
	}

	function activate( state ) {
		document.addEventListener( 'keyup', onDocumentKeyUp, false );
		document.addEventListener( 'click', onDocumentClick, false );

		removeClass( popup, currentState );
		addClass( popup, 'no-transition' );
		addClass( popup, state );

		setTimeout( function() {
			removeClass( popup, 'no-transition' );
			addClass( container, 'modal-active' );
		}, 0 );

		currentState = state;
	}

	function deactivate() {
		document.removeEventListener( 'keyup', onDocumentKeyUp, false );
		document.removeEventListener( 'click', onDocumentClick, false );

		removeClass( container, 'modal-active' );
	}

	function disableBlur() {
		addClass( document.documentElement, 'no-blur' );
	}

	function addClass( element, name ) {
		element.className = element.className.replace( /\s+$/gi, '' ) + ' ' + name;
	}

	function removeClass( element, name ) {
		element.className = element.className.replace( name, '' );
	}

	window.modal = {
		activate: activate,
		deactivate: deactivate,
		disableBlur: disableBlur
	}

})();